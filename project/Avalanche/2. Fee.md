# ðŸ“ Fee

FeeëŠ” AVAXë¡œ ì§€ë¶ˆ, transaction feeëŠ” ì†Œê°ëœë‹¤.

## C-Chain Fee
Gas : Transaction Fee

> [!abstract] Fee ê³„ì‚°
> Total fees: (gas consumed) * (gas price)
> 
> Estimated fees(Maximum gas fees): (gas limit) * (gas price)

### Legacy Fee Transactions

gas price ë§Œ ì •í•¨.

###  Dynamic Fee Transactions

EIP-1559 ë”°ë¦„. [EIP-1559](https://eips.ethereum.org/EIPS/eip-1559) 
EIP(Ethereum Improvement Proposals) ì´ë”ë¦¬ì›€ ê°œì„  ì œì•ˆ

#### EIP-1559

ìƒˆë¡œìš´ ì´ë”ë¦¬ì›€ ìˆ˜ìˆ˜ë£Œ ëª¨ë¸ì— ëŒ€í•œ ì œì•ˆ

- ë¸”ë¡ í—¤ë”ì—Â BaseFee í•„ë“œê°€ ì¶”ê°€
- gas price ëŒ€ì‹  maxPriorityFeePerGasì™€ maxFeePerGas ìž…ë ¥
##### ìš©ì–´
- **base fee :**

	eth_baseFeeë¡œ ë‹¤ìŒë¸”ë¡ì˜ base fee ì˜ˆì¸¡
	ë¸”ë¡ì˜ baseFeeëŠ” ë¶€ëª¨ ë¸”ë¡ì— ë¹„í•´ ë¸”ë¡ì´ ê°€ë“ì°¼ëŠ”ì§€ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìµœëŒ€ 12.5%ê¹Œì§€ ì¦ê°€í•˜ê±°ë‚˜ ê°ì†Œí•  ìˆ˜ ìžˆë‹¤.
	ì•„ë°œëž€ì²´ ë„¤íŠ¸ì›Œí¬ì˜ ê²½ìš° ìµœì € 25 nAVAX (Gwei), ìƒí•œ ì—†ìŒ

- **maxPriorityFeePerGas ( = priority fee = tip):**

	íŠ¸ëžœìž­ì…˜ ìš°ì„ ì²˜ë¦¬ë¥¼ ìœ„í•œ gas ë‹¨ìœ„ ë‹¹ ì§€ë¶ˆ í•  base fee ì´ìƒì˜ ìµœëŒ€ price
	eth_maxPriorityFeePerGas ë¡œ ë¸”ë¡ì— í¬í•¨ë˜ê¸° ìœ„í•œ priority fee ì˜ˆì¸¡

- **maxFeePerGas**
	gas ë‹¨ìœ„ ë‹¹ ì§€ë¶ˆ í•  ìµœëŒ€ price
	base fee + maxPriorityFeePerGas
	
base fee :í”„ë¡œí† ì½œ ë ˆë²¨ì—ì„œ ê²°ì •. 
maxFeePerGas, maxPriorityFeePerGas ëŠ” ìœ ì €ê°€ ì§ì ‘ ìž…ë ¥

>[!note] ì´ë”ë¦¬ì›€ê³¼ì˜ ì°¨ì´ì 
> íŠ¸ëžœìž­ì…˜ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ë©´
> ì´ë”ë¦¬ì›€ì˜ ê²½ìš° priority feeëŠ” ë„¤íŠ¸ì›Œí¬ ê²€ì¦ìžì—ê²Œ ì§€ê¸‰ë˜ëŠ” ë°˜ë©´,
>base fee ì™€ priority fee ëª¨ë‘ ì†Œê°ë¨. ë„¤íŠ¸ì›Œí¬ ê²€ì¦ìžì—ê²Œ ì§€ë¶ˆë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë„¤íŠ¸ì›Œí¬ì—ì„œ ì œê±°ëœë‹¤.

ì°¸ê³  ) avalanche ì—ì„œì˜ ìš©ì–´ ì‚¬ìš©
gas fee cap ( = max fee = maxFeePerGas) : gas ë‹¨ìœ„ ë‹¹ ì§€ë¶ˆ í•  ìµœëŒ€ price

gas tip cap ( = priority fee = maxPriorityFeePerGas) : íŠ¸ëžœìž­ì…˜ ìš°ì„ ì²˜ë¦¬ë¥¼ ìœ„í•œ gas ë‹¨ìœ„ ë‹¹ ì§€ë¶ˆ í•  base fee ì´ìƒì˜ ìµœëŒ€ price

EffectiveTip = min(MaxFeePerGas - BaseFee, maxPriorityFeePerGas)    
		   = min(MaxFeeCap - BaseFee, GasTipCap)
validatiorëŠ” effective tipsê°€ ê°€ìž¥ ë†’ì€ íŠ¸ëžœìž­ì…˜ì— ë†’ì€ ìš°ì„ ìˆœìœ„ë¥¼ ë¶€ì—¬í•˜ì—¬ í•´ë‹¹ íŠ¸ëžœìž­ì…˜ì„ ì±„íƒí•œë‹¤.

>[!warning] Transaction fail
>base fee ê°€ maxFeePerGas(gas fee cap) ë³´ë‹¤ í¬ë‹¤ë©´,
>í•´ë‹¹ íŠ¸ëžœìž­ì…˜ì€ ì‹¤íŒ¨ ì²˜ë¦¬ ëœë‹¤.
>
>maxFeePerGas ë¥¼ 10 (wei) ë¡œ ì„¤ì • í•˜ì—¬ íŠ¸ëžœìž­ì…˜ ë°œìƒ ì‹œ error :
>
>Error: Returned error: transaction underpriced: address 0x2946a0c0FFE94fE6273881278f8829aC373ae231 have gas fee cap (10) < pool minimum fee cap (25000000000)
>

##### gas price
ê±°ëž˜ì— ì§€ë¶ˆë˜ëŠ” **gas price** : 
= min(Max Fee, baseFee + MaxPriorityFee)
= min(gasFeeCap, baseFee + gasTipCap) 

maxFeePerGasëŠ” maxPriorityFeePerGas ë³´ë‹¤ ìž‘ì„ ìˆ˜ ì—†ìŒ.

##### gas Limit

estimateGas í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ë©´
í•´ë‹¹ íŠ¸ëžœìž­ì…˜ì„ ì²˜ë¦¬í•˜ëŠ”ë° í•„ìš”í•œ ì˜ˆìƒ ê°€ìŠ¤ì–‘ (gasLimit)ì„ ê³„ì‚°í•´ì¤Œ.
from, to, value (native token) 
from, to, data (ERC-20, 721, 1155)
(maxFeePerGas, maxPriorityFeePerGas ë¥¼ í¬í•¨í•œ tx ë°ì´í„°ë¡œ í•´ë„ ë¨)

```javascript
  const tx = {
    type: 2,
    nonce,
    to,
    maxPriorityFeePerGas,
    maxFeePerGas,
    value: ethers.utils.parseEther(amount),
    chainId,
  };

  tx.gasLimit = await HTTPSProvider.estimateGas(tx);
  const signedTx = await wallet.signTransaction(tx);  
  const txHash = ethers.utils.keccak256(signedTx);  
  
  console.log("Sending signed transaction");  
  
  // Sending a signed transaction and waiting for its inclusion  
  await (await HTTPSProvider.sendTransaction(signedTx)).wait();
```


#### estimate Fee
```javascript
const historicalBlocks = 4; web3.eth.getFeeHistory(historicalBlocks, "pending", [25, 50, 75]).then(console.log);
```
```json
{ 
	oldestBlock: 12966149, 
	reward: [ 
		[ '0x6fb9cbef7', '0x161dea08f7', '0x28be4928f7' ],
		[ '0x10378b36e1', '0x1bdbc6aae1', '0x20fb1406e1' ], 
		[ '0x112fcac6f6', '0x1dfe0c2cf6', '0x287841aef6' ], 
		[ '0x1dfc552db', '0x59971f2db', '0xd8400c6db' ] 
	], 
	baseFeePerGas: [ 
		'0x1d1b1b8f09', 
		'0x1e5962991f', 
		'0x1d6123090a', 
		'0x210ced0925', 
		'0x252e208712' 
	], 
	gasUsedRatio: [ 
		0.6708618436856891, 
		0.3721915376646354, 
		0.9998122039490063, 
		0.9998039574899923 
	] 
}
```
1. `oldestBlock`
- `oldestBlock: 12966149`: ê°€ìž¥ ì˜¤ëž˜ëœ ë¸”ë¡ì˜ ë²ˆí˜¸ìž…ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” 12966149ë²ˆ ë¸”ë¡ë¶€í„° ì‹œìž‘í•˜ëŠ” ë°ì´í„°ìž…ë‹ˆë‹¤.
 
 2. `reward`
- `reward`: ê° ë¸”ë¡ì—ì„œ ìˆ˜ìˆ˜ë£Œ ë³´ìƒ ë°ì´í„°ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
    - ê° ë°°ì—´ì€ ì„¸ ê°œì˜ ê°’ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìžˆìœ¼ë©°, ê°ê° 25%, 50%, 75% percentilesì—ì„œì˜ ë³´ìƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.
    - ì˜ˆë¥¼ ë“¤ì–´, ì²« ë²ˆì§¸ ë¸”ë¡ì˜ ë³´ìƒ ë°ì´í„°ëŠ” `[ '0x6fb9cbef7', '0x161dea08f7', '0x28be4928f7' ]`ìž…ë‹ˆë‹¤.
    - ê°’ì€ 16ì§„ìˆ˜ ë¬¸ìžì—´ë¡œ í‘œí˜„ë˜ë©°, ì´ë¥¼ 10ì§„ìˆ˜ë¡œ ë³€í™˜í•˜ì—¬ ì´í•´í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

3. `baseFeePerGas`
- `baseFeePerGas`: ê° ë¸”ë¡ì˜ ê¸°ë³¸ ê°€ìŠ¤ ìˆ˜ìˆ˜ë£Œ(base fee per gas)ìž…ë‹ˆë‹¤.
	- ì—¬ê¸°ì—ëŠ” ìš”ì²­í•œ `historicalBlocks` ìˆ˜ì˜ ë¸”ë¡ê³¼ ì¶”ê°€ë¡œ `pending` ë¸”ë¡ì— ëŒ€í•œ ê¸°ë³¸ ê°€ìŠ¤ ìˆ˜ìˆ˜ë£Œê°€ í¬í•¨ë©ë‹ˆë‹¤.
    - ë°°ì—´ì˜ ê° í•­ëª©ì€ 16ì§„ìˆ˜ ë¬¸ìžì—´ë¡œ í‘œí˜„ë©ë‹ˆë‹¤.
    - ì˜ˆë¥¼ ë“¤ì–´, ì²« ë²ˆì§¸ ê°’ì€ `'0x1d1b1b8f09'`ìž…ë‹ˆë‹¤.

4. `gasUsedRatio`
- `gasUsedRatio`: ê° ë¸”ë¡ì˜ ê°€ìŠ¤ ì‚¬ìš© ë¹„ìœ¨ìž…ë‹ˆë‹¤.
    - ê° ê°’ì€ 0ê³¼ 1 ì‚¬ì´ì˜ ìˆ«ìžë¡œ, ë¸”ë¡ì—ì„œ ì‚¬ìš©ëœ ê°€ìŠ¤ì˜ ë¹„ìœ¨ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
    - ì˜ˆë¥¼ ë“¤ì–´, ì²« ë²ˆì§¸ ë¸”ë¡ì˜ ê°€ìŠ¤ ì‚¬ìš© ë¹„ìœ¨ì€ `0.6708618436856891`ë¡œ, ì•½ 67%ì˜ ê°€ìŠ¤ë¥¼ ì‚¬ìš©í•œ ê²ƒìž…ë‹ˆë‹¤.



ì°¸ê³  : https://docs.alchemy.com/docs/how-to-build-a-gas-fee-estimator-using-eip-1559

ì°¸ê³  :
https://docs.avax.network/reference/standards/guides/txn-fees#dynamic-fee-transactions
https://docs.avax.network/build/dapp/advanced/adjusting-gas-price-during-high-network-activity
https://docs.avax.network/build/dapp/advanced/sending-transactions-with-dynamic-fees-using-javascript

https://medium.com/tokamak-network/eip-1559%EC%97%90-%EB%8C%80%ED%95%98%EC%97%AC-30b7f7019507
https://velog.io/@choyeah/EIP-1559
###  Atomic Transaction Fees

Cì²´ì¸ ì—ì„œ ë‹¤ë¥¸ ì²´ì¸ìœ¼ë¡œ export/import í•˜ëŠ” ê±°ëž˜

+---------------------+-------+  
| Item : Gas |  
+---------------------+-------+  
| Unsigned Tx Byte : 1 |  
+---------------------+-------+  
| Signature : 1000 |  
+---------------------+-------+  
| Per Atomic Tx : 10000 |  
+---------------------+-------+

gas used = 1 * len(unsignedTxBytes) + 1,000 * numSignatures + 10,000

actual fee = gasUsed * baseFee (converted to 9 decimals)

## Tx type ì— ë”°ë¥¸ Fee Schedule

+----------+---------------------------+--------------------------------+  
| Chain | Transaction Type | Mainnet Transaction Fee (AVAX) |  
+----------+---------------------------+--------------------------------+  
| P | Create Subnet | 1 |  
+----------+---------------------------+--------------------------------+  
| P | Create Blockchain | 1 |  
+----------+---------------------------+--------------------------------+  
| P | Add Validator | 0 |  
+----------+---------------------------+--------------------------------+  
| P | Add Subnet Validator | 0.001 |  
+----------+---------------------------+--------------------------------+  
| P | Add Permissionless | Primary Network: 0 |  
| | Validator | Subnet: 0.001 |  
+----------+---------------------------+--------------------------------+  
| P | Add Delegator | 0 |  
+----------+---------------------------+--------------------------------+  
| P | Add Subnet Delegator | 0.001 |  
+----------+---------------------------+--------------------------------+  
| P | Add Permissionless | Primary Network: 0 |  
| | Delegator | Subnet: 0.001 |  
+----------+---------------------------+--------------------------------+  
| P | Import AVAX | 0.001 |  
+----------+---------------------------+--------------------------------+  
| P | Export AVAX | 0.001 |  
+----------+---------------------------+--------------------------------+  
| X | Send | 0.001 |  
+----------+---------------------------+--------------------------------+  
| X | Create Asset | 0.01 |  
+----------+---------------------------+--------------------------------+  
| X | Mint Asset | 0.001 |  
+----------+---------------------------+--------------------------------+  
| X | Import AVAX | 0.001 |  
+----------+---------------------------+--------------------------------+  
| X | Export AVAX | 0.001 |  
+----------+---------------------------+--------------------------------+  
| C | Simple send | >= 0.001575* |  
+----------+---------------------------+--------------------------------+

( * ) C-Chain gas price varies. See below.










